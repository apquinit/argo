package start

import (
	"{{.ProjectName}}/app/middleware"
	"{{.ProjectName}}/config"
	"{{.ProjectName}}/core/context"

	"github.com/gin-gonic/gin"
)

// InitializeKernel sets up the Gin engine with middleware and routes
func InitializeKernel() *gin.Engine {
	// Load application configuration
	cfg := config.LoadConfig()

	// Set Gin mode
	if cfg.Mode == "release" {
		gin.SetMode(gin.ReleaseMode)
	} else {
		gin.SetMode(gin.DebugMode)
	}

	// Initialize the Gin engine
	engine := gin.Default()

	// Middleware
	logger := middleware.LoggerMiddleware{}
	engine.Use(func(c *gin.Context) {
		logger.Handle(func(ctx context.Context) {})(context.WrapGinContext(c))
	})

	// Routes
	RegisterRoutes(engine)

	return engine
}
