package start

import (
	"log"

	"{{.ProjectName}}/config"
	"{{.ProjectName}}/app/middleware"

	"github.com/gin-gonic/gin"
)

// InitializeKernel sets up the Gin engine with middleware and routes
func InitializeKernel() *gin.Engine {
	// Load the application configuration
  cfg, err := config.LoadConfig()
  if err != nil {
      log.Fatalf("Error loading configuration: %v", err)
  }

	// Set Gin mode based on environment
	if cfg.Mode == "release" {
		gin.SetMode(gin.ReleaseMode)
	} else {
		gin.SetMode(gin.DebugMode)
	}

	// Initialize the Gin engine
	engine := gin.Default()

	// Register routes
	RegisterRoutes(engine)

	// Register global middleware (applied to all requests)
	engine.Use(middleware.Logger())
	engine.Use(middleware.CORS())

	// Register named middleware (applied to specific groups of routes)

	return engine
}
